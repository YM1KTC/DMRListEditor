<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DMR Contact List D√ºzenleyici</title>
  <meta name="description"
    content="DMR Contact List D√ºzenleyici ile DMR kullanƒ±cƒ±larƒ± i√ßin CSV dosyalarƒ±nƒ± y√ºkleyin, d√ºzenleyin ve dƒ±≈üa aktarƒ±n." />
  <meta name="keywords"
    content="DMR, CSV, D√ºzenleyici, Amat√∂r Radyo, ARC, Amat√∂r Radyocular Derneƒüi, Motorola, Hytera, TYT, Anytone, Baofeng, Radioddity" />
  <meta name="author" content="ARC - Amat√∂r Radyocular Derneƒüi" />
  <meta property="og:title" content="DMR Contact List D√ºzenleyici" />
  <meta property="og:description"
    content="DMR Contact List D√ºzenleyici ile DMR kullanƒ±cƒ±larƒ± i√ßin CSV dosyalarƒ±nƒ± y√ºkleyin, d√ºzenleyin ve dƒ±≈üa aktarƒ±n." />
  <meta property="og:image" content="logo.png" />
  <meta property="og:url" content="https://radio.org.tr/" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="DMR Contact List D√ºzenleyici" />
  <meta name="twitter:description"
    content="DMR Contact List D√ºzenleyici ile DMR kullanƒ±cƒ±larƒ± i√ßin CSV dosyalarƒ±nƒ± y√ºkleyin, d√ºzenleyin ve dƒ±≈üa aktarƒ±n." />
  <meta name="twitter:image" content=logo.png">
  <meta name="twitter:site" content="@ym1ktc" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- DataTables CSS & JS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <style>
    /* Custom control styling */
    #csvTable_length label,
    #csvTable_filter label {
      @apply flex items-center space-x-2 text-sm font-medium text-slate-700;
    }

    #csvTable_info {
      @apply text-sm text-slate-600 font-medium;
    }

    /* Popup Dialog Styles */
    .popup-dialog {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 0;
      border-radius: 12px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      border: 1px solid rgb(226, 232, 240);
      z-index: 1000;
      max-width: 900px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
    }

    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 999;
      animation: fadeIn 0.15s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .popup-close {
      position: absolute;
      right: 14px;
      top: 14px;
      cursor: pointer;
      font-size: 20px;
      color: #94a3b8;
      z-index: 1001;
      width: 32px;
      height: 32px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      transition: all 0.15s ease;
    }

    .popup-close:hover {
      background: #f1f5f9;
      color: #64748b;
    }

    .popup-content {
      padding: 20px;
      padding-top: 24px;
    }

    .popup-photo {
      max-width: 200px;
      height: auto;
      margin: 10px 0;
      border-radius: 6px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="bg-slate-50 min-h-screen">
  <!-- Add alert container div at the top level -->
  <div id="alertContainer"
    class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 flex flex-col gap-2"></div>

  <!-- Header -->
  <header class="fixed top-0 left-0 right-0 bg-white border-b border-slate-200 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <img src="logo.png" alt="Logo" class="h-11 w-auto" />
          <div>
            <h1 class="text-2xl font-semibold tracking-tight text-slate-900">
              DMR Contact List D√ºzenleyici
            </h1>
            <p class="text-sm text-slate-500 mt-0.5">ARC - Amat√∂r Radyocular Derneƒüi</p>
          </div>
        </div>
        <div class="hidden md:flex items-center">
          <span class="px-2.5 py-1 bg-slate-100 text-slate-600 text-xs font-medium rounded-md">
            v2.0
          </span>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="pt-24 pb-12 px-6">
    <div class="max-w-7xl mx-auto space-y-5">

      <!-- File Upload Card -->
      <div class="bg-white rounded-xl border border-slate-200 p-6">
        <div class="flex items-center gap-3 mb-5">
          <div class="p-2.5 bg-slate-100 rounded-lg text-slate-600">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-slate-900">DMR Contact List Y√ºkle</h3>
            <p class="text-sm text-slate-500">CSV formatƒ±ndaki dosyanƒ±zƒ± se√ßin</p>
          </div>
        </div>
        <input type="file" id="csvFile"
          class="block w-full text-sm text-slate-600 file:mr-4 file:py-2.5 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200 transition-colors duration-150 border border-dashed border-slate-300 rounded-lg p-3 hover:border-slate-400" />
      </div>

      <!-- City Filter Card -->
      <div class="bg-white rounded-xl border border-slate-200 p-6">
        <div class="flex items-center gap-3 mb-5">
          <div class="p-2.5 bg-slate-100 rounded-lg text-slate-600">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z" />
            </svg>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-slate-900">≈ûehir Filtresi</h3>
            <p class="text-sm text-slate-500">Belirli bir ≈üehre g√∂re filtreleyin</p>
          </div>
        </div>
        <select id="cityFilter"
          class="w-full px-3 py-2.5 border border-slate-200 rounded-lg bg-white text-sm text-slate-700 focus:border-slate-400 focus:ring-2 focus:ring-slate-100 transition-all duration-150">
          <option value="">T√ºm√º</option>
        </select>
      </div>

      <!-- Table Container -->
      <div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100">
          <h3 class="text-lg font-semibold text-slate-900 flex items-center">
            <svg class="w-5 h-5 mr-2 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2h2a2 2 0 002-2" />
            </svg>
            DMR Kayƒ±tlarƒ± Tablosu
          </h3>
        </div>
        <div class="p-5">
          <div class="bg-slate-50 rounded-lg p-3 mb-4">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
              <div id="csvTable_length" class="flex items-center"></div>
              <div id="csvTable_filter" class="flex items-center"></div>
            </div>
          </div>

          <div class="overflow-x-auto rounded-lg border border-slate-200">
            <table id="csvTable" class="stripe hover w-full"></table>
          </div>

          <div class="bg-slate-50 rounded-lg p-3 mt-4">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
              <div id="csvTable_info" class="flex items-center"></div>
              <div id="csvTable_paginate" class="flex items-center"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
        <!-- Export Section -->
        <div class="col-span-full">
          <h4 class="text-sm font-medium text-slate-500 uppercase tracking-wide mb-3">
            Dƒ±≈üa Aktarma
          </h4>
        </div>

        <button id="exportCsv"
          class="bg-slate-700 text-white px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-slate-800 transition-colors duration-150 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
          </svg>
          Anytone CSV
        </button>

        <button id="exportTytCsv"
          class="bg-slate-700 text-white px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-slate-800 transition-colors duration-150 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
          </svg>
          TYT CSV
        </button>

        <button id="exportTytNoGpsCsv"
          class="bg-slate-700 text-white px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-slate-800 transition-colors duration-150 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
          </svg>
          TYT No GPS
        </button>

        <!-- Tools Section -->
        <div class="col-span-full mt-6">
          <h4 class="text-sm font-medium text-slate-500 uppercase tracking-wide mb-3">
            Ara√ßlar
          </h4>
        </div>

        <button id="filterNonAscii"
          class="bg-white border border-slate-200 text-slate-700 px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-slate-50 hover:border-slate-300 transition-all duration-150 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z" />
          </svg>
          Bozuk Karakter
        </button>

        <button id="fetchRadioId"
          class="bg-white border border-slate-200 text-slate-700 px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-slate-50 hover:border-slate-300 transition-all duration-150 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 12l2 2 4-4" />
          </svg>
          RadioID.net
        </button>

        <!-- Edit Section -->
        <div class="col-span-full mt-6">
          <h4 class="text-sm font-medium text-slate-500 uppercase tracking-wide mb-3">
            D√ºzenleme
          </h4>
        </div>

        <button id="addRow"
          class="bg-white border border-slate-200 text-slate-700 px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-slate-50 hover:border-slate-300 transition-all duration-150 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          Yeni Satƒ±r
        </button>

        <button id="removeRow"
          class="bg-red-600 text-white px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-red-700 transition-colors duration-150 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Satƒ±r Sil
        </button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="mt-8 mx-6">
    <div class="max-w-7xl mx-auto bg-slate-900 rounded-xl overflow-hidden">
      <div class="px-6 py-10">
        <div class="text-center">
          <h3 class="text-xl font-semibold text-white mb-6">
            ARC - Amat√∂r Radyocular Derneƒüi
          </h3>

          <!-- Social Links -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
            <a href="https://t.me/amator_radyocular_dernegi" target="_blank"
              class="group flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 p-3 rounded-lg transition-colors duration-150">
              <svg class="w-5 h-5 text-slate-400 group-hover:text-white" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M12 0C5.374 0 0 5.373 0 12s5.374 12 12 12 12-5.373 12-12S18.626 0 12 0zm5.568 8.16c-.169 1.858-.896 6.728-.896 6.728-.896 6.728-.896 6.728-.896 6.728s-.239 1.987-.239 1.987c-.05.226-.162.332-.332.332-.128 0-.266-.05-.402-.154l-3.402-2.604c-.896-.686-1.653-1.234-2.383-1.653-.226-.129-.402-.315-.402-.587 0-.218.129-.402.315-.508l7.512-6.728c.182-.162.315-.402.315-.651 0-.332-.236-.543-.543-.543-.195 0-.402.089-.573.226L8.427 11.46c-.896.665-1.718 1.266-2.604 1.931-.154.115-.332.182-.520.182-.402 0-.762-.226-.982-.573L2.593 9.867c-.182-.288-.226-.65-.066-.975.162-.332.520-.573.896-.573h14.374c.658 0 1.195.537 1.195 1.195-.001.233-.066.448-.182.646z" />
              </svg>
              <span class="text-sm font-medium text-slate-300 group-hover:text-white">Telegram</span>
            </a>

            <a href="https://instagram.com/ym1ktc" target="_blank"
              class="group flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 p-3 rounded-lg transition-colors duration-150">
              <svg class="w-5 h-5 text-slate-400 group-hover:text-white" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
              </svg>
              <span class="text-sm font-medium text-slate-300 group-hover:text-white">Instagram</span>
            </a>

            <a href="https://www.youtube.com/@YM1KTC" target="_blank"
              class="group flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 p-3 rounded-lg transition-colors duration-150">
              <svg class="w-5 h-5 text-slate-400 group-hover:text-white" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
              </svg>
              <span class="text-sm font-medium text-slate-300 group-hover:text-white">YouTube</span>
            </a>

            <a href="https://www.linkedin.com/company/arctr/" target="_blank"
              class="group flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 p-3 rounded-lg transition-colors duration-150">
              <svg class="w-5 h-5 text-slate-400 group-hover:text-white" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
              </svg>
              <span class="text-sm font-medium text-slate-300 group-hover:text-white">LinkedIn</span>
            </a>
          </div>

          <!-- Contact Info -->
          <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-8 text-slate-400">
            <a href="mailto:bilgi@radio.org.tr"
              class="flex items-center gap-2 hover:text-white transition-colors text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              bilgi@radio.org.tr
            </a>

            <div class="hidden md:block w-px h-4 bg-slate-700"></div>

            <a href="https://radio.org.tr/" target="_blank"
              class="flex items-center gap-2 hover:text-white transition-colors text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
              </svg>
              radio.org.tr
            </a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Popup Dialog -->
  <div class="popup-overlay" id="popupOverlay"></div>
  <div class="popup-dialog" id="callsignDialog">
    <span class="popup-close" onclick="closePopup()">&times;</span>
    <div class="popup-content">
      <h3 class="text-lg font-semibold text-slate-900 mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        √áaƒürƒ± ƒ∞≈üareti Detaylarƒ±
      </h3>
      <div id="callsignContent"></div>
    </div>
  </div>

  <script>
    // Function to create alert container
    function createAlertContainer() {
      const alertContainer = document.createElement('div');
      alertContainer.id = 'alertContainer';
      alertContainer.className =
        'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 flex flex-col gap-2';
      document.body.appendChild(alertContainer);
    }

    // Initialize alert container on page load
    document.addEventListener('DOMContentLoaded', function () {
      createAlertContainer();
    });

    // Single alert handling function
    function showAlert(message, type = 'info') {
      const alertContainer = document.getElementById('alertContainer');
      if (!alertContainer) return;

      const alert = document.createElement('div');
      alert.className = `
          max-w-sm w-full
          ${type === 'info' ? 'bg-blue-100 border-blue-400 text-blue-700' : ''}
          ${type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : ''}
          ${type === 'warning' ? 'bg-yellow-100 border-yellow-400 text-yellow-700' : ''}
          ${type === 'error' ? 'bg-red-100 border-red-400 text-red-700' : ''}
          border px-4 py-3 rounded shadow-lg transition-all duration-300
        `;

      alert.innerHTML = `
          <div class="flex justify-between items-start">
            <span class="block flex-grow">${message}</span>
            <button class="ml-4 ${type === 'info' ? 'text-blue-500 hover:text-blue-700' : ''}
              ${type === 'success' ? 'text-green-500 hover:text-green-700' : ''}
              ${type === 'warning' ? 'text-yellow-500 hover:text-yellow-700' : ''}
              ${type === 'error' ? 'text-red-500 hover:text-red-700' : ''}">
              X
            </button>
          </div>
        `;

      alert.querySelector('button').addEventListener('click', () => {
        alert.remove();
      });

      alertContainer.appendChild(alert);

      setTimeout(() => {
        if (alert && alert.parentNode) {
          alert.remove();
        }
      }, 5000);
    }
    let table;
    let filterNonAscii = false;
    let lastUsedId = 0; // Track the last used ID
    let isGrouped = false; // Track grouping state

    // Function to trim fields over 16 characters
    function trimFields(data) {
      return data.map((row) => {
        Object.keys(row).forEach((key) => {
          if (typeof row[key] === 'string' && row[key].length > 16) {
            row[key] = row[key].substring(0, 16);
          }
        });
        return row;
      });
    }

    // DataTable'ƒ± Ba≈ülat
    function initializeTable(data) {
      data = trimFields(data); // Trim fields before initializing the table
      // Find the highest No. value in existing data
      lastUsedId = Math.max(...data.map((row) => parseInt(row.No) || 0));

      // Get unique cities and populate filter dropdown
      const cities = [...new Set(data.map((row) => row.City))].filter((city) => city).sort();
      const cityFilter = document.getElementById('cityFilter');
      cityFilter.innerHTML =
        '<option value="">T√ºm√º</option>' +
        cities.map((city) => `<option value="${city}">${city}</option>`).join('');

      const columns = [
        {
          title: 'No.',
          data: 'No',
          orderable: false,
          render: function (data, type, row, meta) {
            if (type === 'display') {
              return `<input type="checkbox" class="row-select mr-2">${data}`;
            }
            return data;
          },
        },
        { title: 'DMR Radio ID', data: 'Radio ID' },
        { title: '√áaƒürƒ± ƒ∞≈üareti', data: 'Callsign' },
        { title: 'ƒ∞sim', data: 'Name' },
        { title: '≈ûehir', data: 'City' },
        {
          title: 'ƒ∞≈ülem',
          data: null,
          orderable: false,
        },
      ];

      const tableConfig = {
        data: data,
        columns: columns,
        paging: true,
        pageLength: 25,
        searching: true,
        autoWidth: false,
        order: [],
        dom: '<"#csvTable_length"l><"#csvTable_filter"f>rt<"#csvTable_info"i><"#csvTable_paginate"p>',
        rowGroup: {
          enable: false,
          dataSrc: 'City',
          startRender: function (rows, group) {
            return `<tr class="group">
                        <td colspan="6" class="bg-gray-200 font-bold px-6 py-2">
                          ${group} (${rows.count()} kayƒ±t)
                        </td>
                      </tr>`;
          },
        },
        language: {
          lengthMenu: 'Sayfa ba≈üƒ±na _MENU_ kayƒ±t g√∂ster',
          zeroRecords: 'Kayƒ±t bulunamadƒ±',
          info: 'Toplam _PAGES_ sayfadan _PAGE_. sayfa g√∂steriliyor',
          infoEmpty: 'Kayƒ±t bulunamadƒ±',
          infoFiltered: '(_MAX_ kayƒ±t i√ßerisinden filtrelendi)',
          search: 'Ara:',
          paginate: {
            first: 'ƒ∞lk',
            last: 'Son',
            next: 'Sonraki',
            previous: '√ñnceki',
          },
        },
        columnDefs: [
          {
            targets: [0, 1, 2, 3, 4], // Specify columns that should have input fields
            render: function (data, type, row, meta) {
              const bgClass = row.isNew ? 'bg-green-100' : 'bg-gray-50';
              return type === 'display'
                ? `<input type="text" value="${data}" class="w-full ${bgClass} border rounded p-1">`
                : data;
            },
          },
          {
            targets: 5, // The magnifier column
            render: function (data, type, row, meta) {
              if (type === 'display') {
                const bgClass = row.isNew ? 'bg-green-100' : '';
                return `
                    <div class="${bgClass} p-1">
                      <a href="#" onclick="fetchCallsignDetails('${row.Callsign}')" class="text-blue-500 hover:text-blue-700 mr-2" title="SORGULAMA">üëÄ</a>
                      <a href="https://www.kiyiemniyeti.gov.tr/ehizmetler/telsiz_cagri_isareti_sorgula?CallSign=${row.Callsign}" target="_blank" class="text-blue-500 hover:text-blue-700 mr-2" title="KEGM">üîç</a>
                      <a href="https://www.qrz.com/db/${row.Callsign}" target="_blank" class="text-blue-500 hover:text-blue-700" title="QRZ.com">üì°</a>
                    </div>
                  `;
              }
              return data;
            },
          },
        ],
      };

      table = $('#csvTable').DataTable(tableConfig);

      // Add custom city filtering
      $('#cityFilter').on('change', function () {
        const selectedCity = $(this).val();
        table.column(4).search(selectedCity).draw();
      });

      // Add row selection handling
      $('#csvTable tbody').on('click', 'input.row-select', function (e) {
        e.stopPropagation();
        $(this).closest('tr').toggleClass('selected');
      });
    }

    // Add toggle grouping function
    function toggleGrouping() {
      isGrouped = !isGrouped;
      const data = table.rows().data().toArray();
      table.destroy();

      const btn = $('#toggleGrouping');
      btn.html(`≈ûehirlere G√∂re Grupla: ${isGrouped ? '‚úÖ' : '‚ùå'}`);

      const tableConfig = {
        data: data,
        // ...copy existing table config but modify rowGroup...
        rowGroup: {
          enable: isGrouped,
          dataSrc: 'City',
          startRender: function (rows, group) {
            return `<tr class="group">
                        <td colspan="6" class="bg-gray-200 font-bold px-6 py-2">
                          ${group} (${rows.count()} kayƒ±t)
                        </td>
                      </tr>`;
          },
        },
      };

      table = $('#csvTable').DataTable(tableConfig);
      showAlert(`≈ûehir gruplandƒ±rmasƒ± ${isGrouped ? 'a√ßƒ±ldƒ±' : 'kapandƒ±'}.`, 'info');
    }

    // CSV'yi JSON'a √áevir
    function parseCSV(csv) {
      const lines = csv.split('\n');
      const headers = lines[0].split(',').map((header) => header.trim().replace(/\"/g, ''));
      return lines
        .slice(1)
        .filter((line) => line.trim() !== '') // Filter out empty lines
        .map((line, index) => {
          const fields = line.split(',');
          // Check if all fields are empty
          if (fields.every((field) => !field || field.trim() === '')) {
            return null;
          }
          const obj = headers.reduce(
            (obj, header, i) => {
              obj[header] = fields[i]?.replace(/\"/g, '').trim() || '';
              return obj;
            },
            { No: index + 1 }
          );
          obj['Call Type'] = 'Private Call';
          obj['Call Alert'] = 'None';
          return obj;
        })
        .filter((row) => row !== null) // Remove null entries
        .map((row, index) => ({ ...row, No: index + 1 })) // Reindex
        .map((row) => trimFields([row])[0]); // Trim fields
    }

    // DataTable'ƒ± CSV'ye Dƒ±≈üa Aktar
    function exportCSV() {
      const data = table
        .rows()
        .data()
        .toArray()
        .map((row, index) => {
          const rowElement = table.row(index).node();
          const inputs = rowElement.querySelectorAll('input[type="text"]');
          return {
            No: row.No,
            'Radio ID': inputs[0].value,
            Callsign: inputs[1].value,
            Name: inputs[2].value,
            City: inputs[3].value,
            State: '',
            Country: '',
            Remarks: '',
            'Call Type': 'Private Call',
            'Call Alert': 'None',
          };
        });

      const headers = [
        'No.',
        'Radio ID',
        'Callsign',
        'Name',
        'City',
        'State',
        'Country',
        'Remarks',
        'Call Type',
        'Call Alert',
      ];
      let csv = headers.map((header) => `"${header}"`).join(',') + '\r\n';

      data.forEach((row, index) => {
        csv +=
          `"${index + 1}",` +
          headers
            .slice(1)
            .map((h) => `"${row[h] || ''}"`)
            .join(',') +
          '\r\n';
      });

      // Son satƒ±rdaki yeni satƒ±r karakterini kaldƒ±r
      csv = csv.trim();

      // Add one blank line at the end
      csv = csv + '\r\n';

      const blob = new Blob([csv], { type: 'text/csv;charset=us-ascii;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, '0');
      const mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
      const yyyy = today.getFullYear();
      a.download = `Anytone-${dd}-${mm}-${yyyy}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // TYT CSV Export Function
    function exportTYTCSV() {
      const data = table
        .rows()
        .data()
        .toArray()
        .map((row, index) => {
          const rowElement = table.row(index).node();
          const inputs = rowElement.querySelectorAll('input[type="text"]');
          const name = `${inputs[1].value} ${inputs[2].value}`; // Combine Callsign and Name
          const radioId = inputs[0].value;
          return `${name},2,${radioId},No`;
        });

      const csv = data.join('\r\n') + '\r\n'; // Add newline at the end

      const blob = new Blob([csv], { type: 'text/csv;charset=us-ascii;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, '0');
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const yyyy = today.getFullYear();
      a.download = `TYT-${dd}-${mm}-${yyyy}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      showAlert('TYT formatƒ±ndaki CSV ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±.', 'success');
    }

    // Add TYT No GPS Export Function
    function exportTYTNoGPSCSV() {
      const data = table
        .rows()
        .data()
        .toArray()
        .map((row, index) => {
          const rowElement = table.row(index).node();
          const inputs = rowElement.querySelectorAll('input[type="text"]');
          return {
            RadioID: inputs[0].value,
            CallSign: inputs[1].value,
            Name: inputs[2].value,
            NickName: '', // Changed from inputs[1].value to empty string
            City: inputs[3].value,
            State: '',
            Country: '',
          };
        });

      const headers = ['RadioID', 'CallSign', 'Name', 'NickName', 'City', 'State', 'Country'];
      let csv = headers.join(',') + '\r\n';

      data.forEach((row) => {
        csv += headers.map((header) => `${row[header] || ''}`).join(',') + '\r\n';
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=us-ascii;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, '0');
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const yyyy = today.getFullYear();
      a.download = `TYT-NoGPS-${dd}-${mm}-${yyyy}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      showAlert('TYT GPSsiz formatƒ±ndaki CSV ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±.', 'success');
    }

    // Dosya Y√ºkleme ƒ∞≈ülemi
    $('#csvFile').on('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const csv = e.target.result;
        const data = parseCSV(csv);
        if (table) table.destroy();
        initializeTable(data);
      };
      reader.readAsText(file);
    });

    // CSV Dƒ±≈üa Aktarma Etkinliƒüi
    $('#exportCsv').on('click', function () {
      exportCSV();
      showAlert('CSV ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±.', 'success');
    });

    // Add TYT Export Button Event Listener
    $('#exportTytCsv').on('click', exportTYTCSV);

    // Add event listener for new TYT No GPS Export button
    $('#exportTytNoGpsCsv').on('click', exportTYTNoGPSCSV);

    // ASCII Olmayan Filtreyi A√ß/Kapat
    $('#filterNonAscii').on('click', function () {
      filterNonAscii = !filterNonAscii;
      $(this).html(`Bozuk Karakterleri Bul: ${filterNonAscii ? '‚úÖ' : '‚ùå'}`);
      table.draw();
      showAlert(`Bozuk karakter filtresi ${filterNonAscii ? 'a√ßƒ±ldƒ±' : 'kapandƒ±'}.`, 'info');
    });

    // ASCII Olmayan Karakterler i√ßin √ñzel Arama Fonksiyonu
    $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
      if (!filterNonAscii) return true;
      return data.some((value) => /[^\x00-\x7F]/.test(value));
    });

    // RadioID.net'ten T√ºrkiye kayƒ±tlarƒ±nƒ± √ßekme
    async function fetchTurkishUsers() {
      try {
        const response = await fetch(
          'https://radioid.bugra.workers.dev/api/dmr/user/?country=Turkiye&country=T%C3%BCrkiye'
        );
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();

        // Tablonun var olduƒüundan emin ol
        if (!table) {
          showAlert('√ñnce bir CSV dosyasƒ± y√ºkleyin.', 'warning');
          return;
        }

        // Get Turkish users from API response
        const turkishUsers = data.results;

        // Mevcut tablo verilerini al
        const existingData = table.rows().data().toArray();
        const existingIds = new Set(existingData.map((row) => row['Radio ID']));

        // Yeni kayƒ±tlarƒ± ekle
        const newUsers = turkishUsers.filter((user) => !existingIds.has(user.id.toString()));

        if (newUsers.length === 0) {
          showAlert('Eklenecek yeni kayƒ±t bulunamadƒ±.', 'warning');
          return;
        }
        table.draw(); // Tabloyu yeniden √ßiz

        // Artan ID'leri kullanarak yeni kayƒ±tlarƒ± olu≈ütur
        const newRecords = newUsers
          .map((user) => {
            lastUsedId++; // Increment the ID counter
            return {
              No: lastUsedId,
              'Radio ID': user.id.toString(),
              Callsign: user.callsign,
              Name: user.fname,
              City: user.city || '',
              State: user.state || '',
              Country: '',
              Remarks: user.remarks || '',
              'Call Type': 'Private Call',
              'Call Alert': 'None',
              isNew: true, // Add this property
            };
          })
          .map((row) => trimFields([row])[0]); // Trim fields

        // Tabloyu yeniden olu≈ütur
        table.destroy();
        initializeTable([...existingData, ...newRecords]);

        showAlert(
          `${newUsers.length} yeni kayƒ±t eklendi.\nYeni kayƒ±tlar en sonda ye≈üil renkte belirtilmi≈ütir.`,
          'success'
        );
      } catch (error) {
        console.error('Veri √ßekme hatasƒ±:', error);
        showAlert('Veriler alƒ±nƒ±rken bir hata olu≈ütu: ' + error.message, 'error');
      }
    }

    // RadioID.net butonu i√ßin olay dinleyici
    $('#fetchRadioId').on('click', fetchTurkishUsers);

    // Yeni satƒ±r ekleme i≈ülevi
    function addNewRow() {
      lastUsedId++;
      const newRow = {
        No: lastUsedId,
        'Radio ID': '',
        Callsign: '',
        Name: '',
        City: '',
        State: '',
        Country: '',
        Remarks: '',
        'Call Type': 'Private Call',
        'Call Alert': 'None',
      };

      table.row.add(trimFields([newRow])[0]).draw(); // Trim fields
    }

    // Se√ßili satƒ±rlarƒ± kaldƒ±rma i≈ülevi
    function removeSelectedRows() {
      const selectedRows = table.rows('.selected');
      if (selectedRows.count() === 0) {
        showAlert('L√ºtfen silinecek satƒ±rƒ± se√ßin', 'warning');
        return;
      }

      if (confirm(`${selectedRows.count()} satƒ±r silinecek. Emin misiniz?`)) {
        selectedRows.remove().draw();
        showAlert(`${selectedRows.count()} satƒ±r silindi.`, 'success');
      }
    }

    // Yeni butonlar i√ßin olay dinleyicileri ekle
    $('#addRow').on('click', addNewRow);
    $('#removeRow').on('click', removeSelectedRows);

    // Add these new functions for popup handling
    function showPopup() {
      document.getElementById('popupOverlay').style.display = 'block';
      document.getElementById('callsignDialog').style.display = 'block';
    }

    function closePopup() {
      document.getElementById('popupOverlay').style.display = 'none';
      document.getElementById('callsignDialog').style.display = 'none';
    }

    async function fetchCallsignDetails(callsign) {
      try {
        // Create loading state in popup
        const content = document.getElementById('callsignContent');
        content.innerHTML =
          '<div class="text-center"><div class="animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"></div><p class="mt-2">Y√ºkleniyor...</p></div>';
        showPopup();

        // Fetch both APIs in parallel
        const [tacallbookResponse, qrzResponse] = await Promise.all([
          fetch(`https://tacallbook.bugra.workers.dev/${callsign}`),
          fetch(`https://qrz.bugra.workers.dev/qrz/${callsign}`),
        ]);

        const tacallbookData = await tacallbookResponse.json();
        const qrzData = await qrzResponse.json();

        // Combine and display the data
        content.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-slate-50 p-4 rounded-lg h-full">
                <h4 class="text-sm font-semibold text-slate-900 mb-3">üáπüá∑ TACALLBOOK Bilgileri</h4>
                <div class="grid grid-cols-2 gap-x-3 gap-y-1.5 text-sm">
                  <div class="font-medium text-slate-600">√áaƒürƒ± ƒ∞≈üareti:</div><div class="text-slate-900">${tacallbookData.isaret || '-'
          }</div>
                  <div class="font-medium text-slate-600">ƒ∞sim:</div><div class="text-slate-900">${tacallbookData.isim || '-'}</div>
                  <div class="font-medium text-slate-600">Adres:</div><div class="text-slate-900">${tacallbookData.adres || ''} ${tacallbookData.adres2 || ''
          }</div>
                  ${tacallbookData.cep
            ? `<div class="font-medium text-slate-600">Telefon:</div><div class="text-slate-900">${tacallbookData.cep}</div>`
            : ''
          }
                  ${tacallbookData.eskiIsaret
            ? `<div class="font-medium text-slate-600">Eski √áaƒürƒ± ƒ∞≈üareti:</div><div class="text-slate-900">${tacallbookData.eskiIsaret}</div>`
            : ''
          }
                </div>
                ${tacallbookData.photo
            ? `<img src="${tacallbookData.photo}" class="popup-photo mt-3 mx-auto" alt="Operator Photo">`
            : ''
          }
              </div>

              <div class="bg-slate-50 p-4 rounded-lg h-full">
                <h4 class="text-sm font-semibold text-slate-900 mb-3">üåç QRZ.com Bilgileri</h4>
                <div class="grid grid-cols-2 gap-x-3 gap-y-1.5 text-sm">
                  <div class="font-medium text-slate-600">√áaƒürƒ± ƒ∞≈üareti:</div><div class="text-slate-900">${qrzData.call || '-'}</div>
                  <div class="font-medium text-slate-600">ƒ∞sim:</div><div class="text-slate-900">${qrzData.fname || ''} ${qrzData.name || ''
          }</div>
                  <div class="font-medium text-slate-600">Adres:</div><div class="text-slate-900">${qrzData.addr1 || ''} ${qrzData.addr2 || ''
          }</div>
                  <div class="font-medium text-slate-600">√úlke:</div><div class="text-slate-900">${qrzData.country || '-'}</div>
                  <div class="font-medium text-slate-600">Grid:</div><div class="text-slate-900">${qrzData.grid || '-'}</div>
                  ${qrzData.class
            ? `<div class="font-medium text-slate-600">Lisans:</div><div class="text-slate-900">${qrzData.class}</div>`
            : ''
          }
                </div>
                ${qrzData.image
            ? `<img src="${qrzData.image}" class="popup-photo mt-3 mx-auto" alt="QRZ Photo">`
            : ''
          }
              </div>
            </div>
          `;
      } catch (error) {
        console.error('API Error:', error);
        showAlert('√áaƒürƒ± i≈üareti bilgileri alƒ±namadƒ±: ' + error.message, 'error');
      }
    }

    // Add event listener for grouping button
    $('#toggleGrouping').on('click', toggleGrouping);

    // Add click handler for popup overlay
    document.getElementById('popupOverlay').onclick = closePopup;
  </script>
</body>

</html>